
<div id="widget-panelAmigos" style="background-color: lavender; ">
    <input type="text" class="form-control" placeholder="Buscar amigo" id="filtro-amigo"/>
    <table class="table table-hover">
        <tbody id="tableFriends">

        </tbody>
    </table>
</div>

<script>
    var amigos = [];
    var selectedFriend = null;
    var searchInterval = null;
    $(document).ready(function () {
        $.ajax(
            {
                url : URLbase + "/amigos",
                type : "GET",
                data: { },
                dataType: 'json',
                headers: { "token": token },
                success : function (res) {
                    amigos = JSON.parse(res);
                    listFriends(amigos);
                },
                error : function (error) {
                    showNotification(error.responseJSON.error, "alert alert-danger");
                }
            }
        )
    });

    $('#filtro-amigo').on('input',function(e){
        var filtro = [];
        var nombreFiltro = $("#filtro-amigo").val();

        for (i = 0; i < amigos.length; i++) {
            if (amigos[i].name.toLowerCase().indexOf(nombreFiltro.toLowerCase()) != -1
                || amigos[i].surname.toLowerCase().indexOf(nombreFiltro.toLowerCase()) != -1
                || (amigos[i].name.toLowerCase() + " " + amigos[i].surname.toLowerCase()).indexOf(nombreFiltro.toLowerCase()) != -1)
            {
                filtro.push(amigos[i]);
            }
        }
        listFriends(filtro);
    });

    function listFriends(friends){
        let myNode = document.getElementById("tableFriends");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.lastChild);
        }

        for (i = 0; i < friends.length; i++) {
            $("#tableFriends").append(
                "<tr id=" + friends[i]._id + " onClick=changeSelectedFriend('"+friends[i].email+"') >" +
                "<td>" + friends[i].name + " " + friends[i].surname + "</td>" +
                "<td>UnreadMessages</td>" +
                "</tr>"
            );
        }
    }

    function changeSelectedFriend(email) {
        selectedFriend = email;
        updateChat(selectedFriend);
        if (searchInterval) clearInterval(searchInterval);
        searchInterval = setInterval( () => updateChat(selectedFriend), 1000 );
    }
</script>