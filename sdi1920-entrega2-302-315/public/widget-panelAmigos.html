
<div id="widget-panelAmigos" style="background-color: lavender; ">
    <table class="table table-hover">
        <thead>
        <tr>
            <th class="col-md-1"></th>
            <th class="col-md-1"></th>
        </tr>
        </thead>
        <tbody id="tableFriends">

        </tbody>
    </table>
</div>

<script>
    var amigos = [];
    var selectedFriend = null;
    var searchInterval = null;
    $(document).ready(function () {
        $.ajax(
            {
                url : URLbase + "/amigos",
                type : "GET",
                data: { },
                dataType: 'json',
                headers: { "token": token },
                success : function (res) {
                    amigos = JSON.parse(res);
                    listFriends();
                },
                error : function (error) {
                    showNotification(error, "alert alert-danger");
                }
            }
        )
    });

    function listFriends(){
        let myNode = document.getElementById("tableFriends");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.lastChild);
        }

        for (i = 0; i < amigos.length; i++) {
            $("#tableFriends").append(
                "<tr id=" + amigos[i]._id + " onClick=changeSelectedFriend('"+amigos[i].email+"') >" +
                "<td>" + amigos[i].name + " " + amigos[i].surname + "</td>" +
                "<td>UnreadMessages</td>" +
                "</tr>"
            );
        }
    }

    function changeSelectedFriend(email) {
        selectedFriend = email;
        updateChat(selectedFriend);
        if (searchInterval) clearInterval(searchInterval);
        searchInterval = setInterval( () => updateChat(selectedFriend), 1000 );
    }
</script>